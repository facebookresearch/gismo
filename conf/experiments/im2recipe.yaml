# @package _group_

im2recipe:
  comment: 'default configuration for im2recipe'
  image_encoder: resnet50_encoder
  ingr_predictor: ingr_predictor_ff_with_card_pred
  pretrained_im2ingr:
    freeze: False 
    load_pretrained_from: None
  recipe_gen: recipe_gen_tf
  optimization:
    seed: 1235
    lr: 0.001
    scale_lr_pretrained: 0.01
    lr_decay_rate: 0.99
    lr_decay_every: 1
    weight_decay: 0.0
    max_epochs: 400
    patience: 20
    loss_weights:
      label_loss: 0.0
      cardinality_loss: 0.0
      eos_loss: 0.0
      recipe_loss: 1.0
  ingr_teachforce:
    train: True
    val: True
    test: use_predictions

search_example_im2recipe:
  comment: 'example of hyper-parameter search for im2recipe'
  parent: im2recipe
  optimization:
    seed: SEARCH[11,12]

# -----------------------------------------------------------------------------

im2recipe_invcooking1.0:
  comment: 'inverse cooking 1.0 model'
  parent: im2recipe
  pretrained_im2ingr:
    freeze: True
    load_pretrained_from: /checkpoint/qduval/inversecooking2.0/48204083/im2ingr-im2ingr_resnet50_ff_bce_cat
    # load_pretrained_from: /checkpoint/adrianars/inversecooking2.0/im2ingr-im2ingr_resnet50_ff_bce_cat/

im2recipe_invcooking1.0_weight_decay:
  parent: im2recipe_invcooking1.0
  optimization:
    lr: 0.001
    weight_decay: 0.00001

im2recipe_invcooking1.0_concat_gelu:
  comment: 'inverse cooking 1.0 model'
  parent: im2recipe
  recipe_gen: recipe_gen_tf_gelu
  pretrained_im2ingr:
    freeze: True
    load_pretrained_from: /checkpoint/qduval/inversecooking2.0/48204083/im2ingr-im2ingr_resnet50_ff_bce_cat
    # load_pretrained_from: /checkpoint/adrianars/inversecooking2.0/im2ingr-im2ingr_resnet50_ff_bce_cat/

im2recipe_resnext101:
  comment: 'inverse cooking 1.0 with resnet101'
  parent: im2recipe
  image_encoder: resnext101_32x8d_encoder
  pretrained_im2ingr:
    freeze: True
    load_pretrained_from: /checkpoint/qduval/inversecooking2.0/48204084/im2ingr-im2ingr_resnext101_ff_bce_cat

# -----------------------------------------------------------------------------
# Basic VITs
# -----------------------------------------------------------------------------

im2recipe_vit32:
  comment: 'evaluation of the performance of vision transformers patch 32'
  parent: im2recipe
  image_encoder:
    model: vit
    pretrained: True
    dropout: 0.1
    patch_size: 32
    n_cls_tokens: 1
    freeze: False
  pretrained_im2ingr:
    freeze: True
    load_pretrained_from: /checkpoint/qduval/inversecooking2.0/48204090/im2ingr-im2ingr_vit_32_ff_bce_cat
    # load_pretrained_from: /checkpoint/qduval/inversecooking2.0/47053824/im2ingr-im2ingr_vit_32_ff_bce_cat/best-v1.ckpt
  optimization:
    lr: 0.001
    weight_decay: 0.00001

im2recipe_vit16:
  comment: 'evaluation of the performance of vision transformers patch 16'
  parent: im2recipe
  image_encoder:
    model: vit
    pretrained: True
    dropout: 0.1
    patch_size: 16
    n_cls_tokens: 1
    freeze: False
  pretrained_im2ingr:
    freeze: True
    # Trained with batch size 32
    load_pretrained_from: /checkpoint/qduval/inversecooking2.0/48547833/im2ingr-im2ingr_vit_16_ff_bce_cat
    # Trained with batch size 8
    # load_pretrained_from: /checkpoint/qduval/inversecooking2.0/48204117/im2ingr-im2ingr_vit_16_ff_bce_cat
  optimization:
    lr: 0.001
    weight_decay: 0.00001

# -----------------------------------------------------------------------------
# Flavors of ViTs (no class token)
# -----------------------------------------------------------------------------

im2recipe_vit32_no_class:
  comment: 'evaluation of the performance of vision transformers'
  parent: im2recipe_vit32
  image_encoder:
    n_cls_tokens: 0
  pretrained_im2ingr:
    freeze: True
    load_pretrained_from: /checkpoint/qduval/inversecooking2.0/47277525/im2ingr-im2ingr_vit_32_no_class_ff_bce_cat/

im2recipe_vit32_no_class_conv:
  comment: 'evaluation of the performance of vision transformers'
  parent: im2recipe_vit32_no_class
  image_encoder:
    pooling_kernel_size: 3
  pretrained_im2ingr:
    freeze: True
    load_pretrained_from: /checkpoint/qduval/inversecooking2.0/47308826/im2ingr-im2ingr_vit_32_no_class_ff_bce_cat_conv/

im2recipe_vit_32_no_class_ff_bce_cat_pool2:
  comment: "Trying to reduce the length of the sequence"
  parent: im2recipe_vit32_no_class
  image_encoder:
    pooling_kernel_size: 2
    pooling_kernel_dim: 2
  pretrained_im2ingr:
    freeze: True
    load_pretrained_from: /checkpoint/qduval/inversecooking2.0/47940684/im2ingr-im2ingr_vit_32_no_class_ff_bce_cat_pool2

im2recipe_vit16_no_class:
  comment: 'evaluation of the performance of vision transformers'
  parent: im2recipe_vit16
  image_encoder:
    n_cls_tokens: 0
  pretrained_im2ingr:
    freeze: True
    load_pretrained_from: /checkpoint/qduval/inversecooking2.0/47518179/im2ingr-im2ingr_vit_16_no_class_ff_bce_cat/

im2recipe_vit_16_no_class_ff_bce_cat_pool4:
  comment: "Trying to reduce the length of the sequence"
  parent: im2recipe_vit16_no_class
  image_encoder:
    pooling_kernel_size: 4
    pooling_kernel_dim: 2
  pretrained_im2ingr:
    freeze: True
    load_pretrained_from: /checkpoint/qduval/inversecooking2.0/47940687/im2ingr-im2ingr_vit_16_ff_bce_cat_no_class_pool4

# -----------------------------------------------------------------------------
# Flavors of ViTs (multiple level of class token)
# -----------------------------------------------------------------------------

im2recipe_vit32_multi_level:
  comment: 'evaluation of the performance of vision transformers'
  parent: im2recipe_vit32
  image_encoder:
    additional_repr_levels: [1, 3, 6, 8, 10]
    concatenate_repr_levels: True
  pretrained_im2ingr:
    freeze: True
    load_pretrained_from: /checkpoint/qduval/inversecooking2.0/47552754/im2ingr-im2ingr_vit_32_ff_bce_cat_multi_level/

im2recipe_vit32_multi_level_2:
  comment: 'evaluation of the performance of vision transformers'
  parent: im2recipe_vit32
  image_encoder:
    additional_repr_levels: [1, 3, 6, 8, 10]
    concatenate_repr_levels: False
  pretrained_im2ingr:
    freeze: True
    load_pretrained_from: /checkpoint/qduval/inversecooking2.0/47552760/im2ingr-im2ingr_vit_32_ff_bce_cat_multi_level_2/

im2recipe_vit32_multi_level_3:
  comment: 'evaluation of the performance of vision transformers'
  parent: im2recipe_vit32
  image_encoder:
    additional_repr_levels: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    concatenate_repr_levels: False
  pretrained_im2ingr:
    freeze: True
    load_pretrained_from: /checkpoint/qduval/inversecooking2.0/48543363/im2ingr-im2ingr_vit_32_ff_bce_cat_multi_level_3

im2recipe_vit32_multi_level_4:
  comment: 'evaluation of the performance of vision transformers'
  parent: im2recipe_vit32
  image_encoder:
    additional_repr_levels: [1, 3, 5, 7, 9]
    concatenate_repr_levels: False
  pretrained_im2ingr:
    freeze: True
    load_pretrained_from: /checkpoint/qduval/inversecooking2.0/48543407/im2ingr-im2ingr_vit_32_ff_bce_cat_multi_level_4

im2recipe_vit16_multi_level:
  comment: 'evaluation of the performance of vision transformers'
  parent: im2recipe_vit16
  image_encoder:
    additional_repr_levels: [1, 3, 6, 8, 10]
    concatenate_repr_levels: True
  pretrained_im2ingr:
    freeze: True
    load_pretrained_from: /checkpoint/qduval/inversecooking2.0/47681666/im2ingr-im2ingr_vit_16_ff_bce_cat_multi_level/

im2recipe_vit16_multi_level_2:
  comment: 'evaluation of the performance of vision transformers'
  parent: im2recipe_vit16_multi_level
  image_encoder:
    additional_repr_levels: [1, 3, 6, 8, 10]
    concatenate_repr_levels: False
  pretrained_im2ingr:
    freeze: True
    # Trained with batch 32
    load_pretrained_from: /checkpoint/qduval/inversecooking2.0/48547838/im2ingr-im2ingr_vit_16_ff_bce_cat_multi_level_2
    # Trained with batch 8
    # load_pretrained_from: /checkpoint/qduval/inversecooking2.0/47681740/im2ingr-im2ingr_vit_16_ff_bce_cat_multi_level_2

im2recipe_vit16_multi_level_3:
  comment: 'evaluation of the performance of vision transformers'
  parent: im2recipe_vit16
  image_encoder:
    additional_repr_levels: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    concatenate_repr_levels: False
  pretrained_im2ingr:
    freeze: True
    load_pretrained_from: /checkpoint/qduval/inversecooking2.0/48547834/im2ingr-im2ingr_vit_16_ff_bce_cat_multi_level_3

im2recipe_vit16_multi_level_4:
  comment: 'evaluation of the performance of vision transformers'
  parent: im2recipe_vit16
  image_encoder:
    additional_repr_levels: [1, 3, 5, 7, 9]
    concatenate_repr_levels: False
  pretrained_im2ingr:
    freeze: True
    load_pretrained_from: /checkpoint/qduval/inversecooking2.0/48547836/im2ingr-im2ingr_vit_16_ff_bce_cat_multi_level_4


# -----------------------------------------------------------------------------
# Evaluate impact of ingredient substitutions on the quality of the recipes
# - use the substitution dataset
# - either with teacher forcing or ground truth ingredients or substitutions
# -----------------------------------------------------------------------------

eval_im2recipe_invcooking1:
  parent: im2recipe_invcooking1.0
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48227160/im2recipe-im2recipe_invcooking1.0
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit32:
  parent: im2recipe_vit32
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48227180/im2recipe-im2recipe_vit32
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit16:
  parent: im2recipe_vit16
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48227181/im2recipe-im2recipe_vit16
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit32_no_class:
  parent: im2recipe_vit32_no_class
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/47308686/im2recipe-im2recipe_vit32_no_class
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit32_no_class_conv:
  parent: im2recipe_vit32_no_class_conv
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/47410061/im2recipe-im2recipe_vit32_no_class_conv
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit32_multi_level:
  parent: im2recipe_vit32_multi_level
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/47573940/im2recipe-im2recipe_vit32_multi_level
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit32_multi_level_2:
  parent: im2recipe_vit32_multi_level_2
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/47574002/im2recipe-im2recipe_vit32_multi_level_2
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit16_no_class:
  parent: im2recipe_vit16_no_class
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/47552483/im2recipe-im2recipe_vit16_no_class
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit16_multi_level:
  parent: im2recipe_vit16_multi_level
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/47881172/im2recipe-im2recipe_vit16_multi_level
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit16_multi_level_2:
  parent: im2recipe_vit16_multi_level_2
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/47881171/im2recipe-im2recipe_vit16_multi_level_2
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit_32_no_class_ff_bce_cat_pool2:
  parent: im2recipe_vit_32_no_class_ff_bce_cat_pool2
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48387331/im2recipe-im2recipe_vit_32_no_class_ff_bce_cat_pool2
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit_16_no_class_ff_bce_cat_pool4:
  parent: im2recipe_vit_16_no_class_ff_bce_cat_pool4
  # eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/47989553/im2recipe-im2recipe_vit_16_no_class_ff_bce_cat_pool4
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48387332/im2recipe-im2recipe_vit_16_no_class_ff_bce_cat_pool4
  ingr_teachforce:
    test: use_ground_truth
    # test: use_substitutions

# -----------------------------------------------------------------------------
# Image encoder trained with batch 8 on im2ingr
# -----------------------------------------------------------------------------

eval_im2recipe_vit16_weight_decay_seed_1235:
  parent: im2recipe_vit16_weight_decay
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48319505/im2recipe-im2recipe_vit16_weight_decay
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit16_weight_decay_seed_0:
  parent: im2recipe_vit16_weight_decay
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48483737/im2recipe-im2recipe_vit16_weight_decay
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit16_weight_decay_seed_1:
  parent: im2recipe_vit16_weight_decay
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48483738/im2recipe-im2recipe_vit16_weight_decay
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit16_multi_level_2_weight_decay_seed_1235:
  parent: im2recipe_vit16_multi_level_2
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48271406/im2recipe-search_im2recipe_vit16_multi_level_2
  # eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48279540/im2recipe-im2recipe_vit16_multi_level_2_weight_decay
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit16_multi_level_2_weight_decay_seed_0:
  parent: im2recipe_vit16_multi_level_2
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48483531/im2recipe-im2recipe_vit16_multi_level_2/
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit16_multi_level_2_weight_decay_seed_1:
  parent: im2recipe_vit16_multi_level_2
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48483539/im2recipe-im2recipe_vit16_multi_level_2/
  ingr_teachforce:
    test: use_ground_truth

# -----------------------------------------------------------------------------
# Image encoder trained with batch 8 on im2ingr
# -----------------------------------------------------------------------------

eval_im2recipe_invcooking1_weight_decay_seed_1235:
  parent: im2recipe_invcooking1.0_weight_decay
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48279615/im2recipe-im2recipe_invcooking1.0_weight_decay
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_invcooking1_weight_decay_seed_0:
  parent: im2recipe_invcooking1.0_weight_decay
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48542772/im2recipe-im2recipe_invcooking1.0_weight_decay
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_invcooking1_weight_decay_seed_1:
  parent: im2recipe_invcooking1.0_weight_decay
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48542774/im2recipe-im2recipe_invcooking1.0_weight_decay
  ingr_teachforce:
    test: use_ground_truth

# -----------------------------------------------------------------------------

eval_im2recipe_vit32_weight_decay_seed_1235:
  parent: im2recipe_vit32_weight_decay
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48319495/im2recipe-im2recipe_vit32_weight_decay
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit32_weight_decay_seed_0:
  parent: im2recipe_vit32_weight_decay
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48483748/im2recipe-im2recipe_vit32_weight_decay
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit32_weight_decay_seed_1:
  parent: im2recipe_vit32_weight_decay
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48483761/im2recipe-im2recipe_vit32_weight_decay
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit32_multi_level_2_weight_decay_seed_1235:
  parent: im2recipe_vit32_multi_level_2
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48279511/im2recipe-im2recipe_vit32_multi_level_2_weight_decay
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit32_multi_level_2_weight_decay_seed_0:
  parent: im2recipe_vit32_multi_level_2
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48483522/im2recipe-im2recipe_vit32_multi_level_2
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit32_multi_level_2_weight_decay_seed_1:
  parent: im2recipe_vit32_multi_level_2
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48483527/im2recipe-im2recipe_vit32_multi_level_2
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit32_multi_level_3_weight_decay_seed_1235:
  parent: im2recipe_vit32_multi_level_3
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48593334/im2recipe-im2recipe_vit32_multi_level_3
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit32_multi_level_3_weight_decay_seed_0:
  parent: im2recipe_vit32_multi_level_3
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48594835/im2recipe-im2recipe_vit32_multi_level_3
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit32_multi_level_3_weight_decay_seed_1:
  parent: im2recipe_vit32_multi_level_3
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48594838/im2recipe-im2recipe_vit32_multi_level_3
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit32_multi_level_4_weight_decay_seed_1235:
  parent: im2recipe_vit32_multi_level_4
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48593342/im2recipe-im2recipe_vit32_multi_level_4
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit32_multi_level_4_weight_decay_seed_0:
  parent: im2recipe_vit32_multi_level_4
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48594839/im2recipe-im2recipe_vit32_multi_level_4
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit32_multi_level_4_weight_decay_seed_1:
  parent: im2recipe_vit32_multi_level_4
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48594840/im2recipe-im2recipe_vit32_multi_level_4
  ingr_teachforce:
    test: use_ground_truth

# -----------------------------------------------------------------------------

eval_im2recipe_vit16_seed_1245:
  parent: im2recipe_vit16
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48593439/im2recipe-im2recipe_vit16
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit16_seed_0:
  parent: im2recipe_vit16
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48594821/im2recipe-im2recipe_vit16
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit16_seed_1:
  parent: im2recipe_vit16
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48594822/im2recipe-im2recipe_vit16
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit16_multi_level_3_seed_1245:
  parent: im2recipe_vit16_multi_level_3
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48593355/im2recipe-im2recipe_vit16_multi_level_3/
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit16_multi_level_3_seed_0:
  parent: im2recipe_vit16_multi_level_3
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48594828/im2recipe-im2recipe_vit16_multi_level_3
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit16_multi_level_3_seed_1:
  parent: im2recipe_vit16_multi_level_3
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48594829/im2recipe-im2recipe_vit16_multi_level_3/
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit16_multi_level_4_seed_1245:
  parent: im2recipe_vit16_multi_level_4
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48593356/im2recipe-im2recipe_vit16_multi_level_4/
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit16_multi_level_4_seed_0:
  parent: im2recipe_vit16_multi_level_4
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48594831/im2recipe-im2recipe_vit16_multi_level_4/
  ingr_teachforce:
    test: use_ground_truth

eval_im2recipe_vit16_multi_level_4_seed_1:
  parent: im2recipe_vit16_multi_level_4
  eval_checkpoint_dir: /checkpoint/qduval/inversecooking2.0/48594832/im2recipe-im2recipe_vit16_multi_level_4
  ingr_teachforce:
    test: use_ground_truth

# -----------------------------------------------------------------------------
